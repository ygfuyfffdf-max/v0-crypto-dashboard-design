#!/bin/bash
#
# CHRONOS AI Agent - Interactive CLI
# Script interactivo para usar los modelos de GitHub Models
#

export HOME="${HOME:-/workspaces/v0-crypto-dashboard-design}"

# Colores
PURPLE='\033[0;35m'
CYAN='\033[0;36m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m'

print_banner() {
    echo -e "${PURPLE}"
    echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
    echo "â•‘         ğŸ¤– CHRONOS AI Agent - Interactive CLI                â•‘"
    echo "â•‘              Powered by GitHub Models                        â•‘"
    echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
    echo -e "${NC}"
}

print_models() {
    echo -e "${CYAN}Modelos disponibles:${NC}"
    echo "  1) gpt-5        - OpenAI GPT-5 (General)"
    echo "  2) o3           - OpenAI O3 (Reasoning)"
    echo "  3) gpt-4o       - OpenAI GPT-4o (Fast)"
    echo "  4) codestral    - Mistral Codestral (Code)"
    echo "  5) deepseek-r1  - DeepSeek R1 (Math)"
    echo "  6) grok-3       - xAI Grok 3 (Creative)"
    echo "  7) llama-4      - Meta Llama 4 (Latest)"
    echo "  8) phi-4        - Microsoft Phi-4 (Efficient)"
    echo ""
}

get_model_id() {
    case $1 in
        1|gpt-5) echo "openai/gpt-5" ;;
        2|o3) echo "openai/o3" ;;
        3|gpt-4o) echo "openai/gpt-4o" ;;
        4|codestral) echo "mistral-ai/codestral-2501" ;;
        5|deepseek|deepseek-r1) echo "deepseek/deepseek-r1-0528" ;;
        6|grok|grok-3) echo "xai/grok-3" ;;
        7|llama|llama-4) echo "meta/llama-4-maverick-17b-128e-instruct-fp8" ;;
        8|phi|phi-4) echo "microsoft/phi-4-reasoning" ;;
        *) echo "openai/gpt-5" ;;
    esac
}

run_query() {
    local model=$1
    local prompt=$2

    echo -e "${YELLOW}ğŸ”„ Consultando ${model}...${NC}"
    echo ""

    gh models run "$model" "$prompt"

    echo ""
}

interactive_mode() {
    print_banner
    print_models

    local model="openai/gpt-5"

    while true; do
        echo -e "${GREEN}Modelo actual: ${model}${NC}"
        echo -e "${CYAN}Comandos: 'modelo <num>' para cambiar, 'modelos' para ver lista, 'salir' para terminar${NC}"
        echo -n "ğŸ“ Tu prompt: "
        read -r input

        case $input in
            salir|exit|quit)
                echo -e "${PURPLE}ğŸ‘‹ Â¡Hasta luego!${NC}"
                exit 0
                ;;
            modelos|models)
                print_models
                ;;
            modelo\ *|model\ *)
                local num=${input#* }
                model=$(get_model_id "$num")
                echo -e "${GREEN}âœ“ Modelo cambiado a: ${model}${NC}"
                ;;
            "")
                continue
                ;;
            *)
                run_query "$model" "$input"
                ;;
        esac

        echo ""
    done
}

# Modo directo con argumentos
direct_mode() {
    local model_num="$1"
    shift
    local prompt="$*"

    local model=$(get_model_id "$model_num")
    run_query "$model" "$prompt"
}

# Main
case "${1:-interactive}" in
    -h|--help|help)
        print_banner
        echo "Uso: $0 [modelo] [prompt]"
        echo ""
        echo "Modos:"
        echo "  Sin argumentos    - Modo interactivo"
        echo "  <modelo> <prompt> - Consulta directa"
        echo ""
        print_models
        ;;
    interactive|"")
        interactive_mode
        ;;
    *)
        direct_mode "$@"
        ;;
esac
