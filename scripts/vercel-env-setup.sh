#!/bin/bash
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# ๐ง CHRONOS ELITE - CONFIGURACIรN RรPIDA DE VERCEL ENV VARS
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# Ejecutar: chmod +x scripts/vercel-env-setup.sh && ./scripts/vercel-env-setup.sh
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

set -e

RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
CYAN='\033[0;36m'
NC='\033[0m'

echo -e "${BLUE}"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "๐ง CHRONOS ELITE - CONFIGURACIรN DE VARIABLES VERCEL"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo -e "${NC}"

# Verificar Vercel CLI
if ! command -v vercel &> /dev/null; then
    echo -e "${RED}โ Vercel CLI no encontrado. Instalar con: pnpm add -g vercel${NC}"
    exit 1
fi

# Verificar si estรก logueado
if ! vercel whoami &> /dev/null; then
    echo -e "${YELLOW}โ๏ธ  No estรกs logueado en Vercel. Ejecutando login...${NC}"
    vercel login
fi

echo -e "${GREEN}โ Logueado como: $(vercel whoami)${NC}"
echo ""

# Funciรณn para agregar variable
add_env_var() {
    local var_name=$1
    local var_desc=$2
    local is_required=$3

    if [ "$is_required" = "true" ]; then
        echo -e "${RED}[REQUERIDA]${NC} $var_name: $var_desc"
    else
        echo -e "${YELLOW}[OPCIONAL]${NC} $var_name: $var_desc"
    fi

    read -p "ยฟDeseas configurar $var_name? (s/n): " response
    if [[ "$response" =~ ^[Ss]$ ]]; then
        read -sp "Ingresa el valor para $var_name: " value
        echo ""
        if [ -n "$value" ]; then
            echo "$value" | vercel env add "$var_name" production --force
            echo -e "${GREEN}โ $var_name configurada${NC}"
        else
            echo -e "${YELLOW}โ๏ธ  Valor vacรญo, saltando...${NC}"
        fi
    fi
    echo ""
}

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# VARIABLES CRรTICAS
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

echo -e "${RED}โโโ VARIABLES CRรTICAS (REQUERIDAS) โโโ${NC}"
echo ""

add_env_var "DATABASE_URL" "URL de Turso (libsql://...)" "true"
add_env_var "DATABASE_AUTH_TOKEN" "Token de autenticaciรณn Turso" "true"
add_env_var "NEXTAUTH_URL" "URL de producciรณn (https://...)" "true"
add_env_var "NEXTAUTH_SECRET" "Secret JWT (generar con: openssl rand -base64 32)" "true"

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# VARIABLES DE IA
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

echo ""
echo -e "${BLUE}โโโ VARIABLES DE IA (AL MENOS UNA RECOMENDADA) โโโ${NC}"
echo ""

add_env_var "XAI_API_KEY" "xAI Grok API key (principal)" "false"
add_env_var "OPENAI_API_KEY" "OpenAI API key (fallback)" "false"
add_env_var "ANTHROPIC_API_KEY" "Anthropic Claude API key" "false"
add_env_var "GOOGLE_GENERATIVE_AI_API_KEY" "Google Gemini API key" "false"

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# VARIABLES DE VOZ
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

echo ""
echo -e "${CYAN}โโโ VARIABLES DE VOZ (OPCIONAL) โโโ${NC}"
echo ""

add_env_var "ELEVENLABS_API_KEY" "ElevenLabs TTS API key" "false"
add_env_var "DEEPGRAM_API_KEY" "Deepgram STT API key" "false"

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# VARIABLES PรBLICAS
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

echo ""
echo -e "${GREEN}โโโ VARIABLES PรBLICAS โโโ${NC}"
echo ""

add_env_var "NEXT_PUBLIC_BASE_URL" "URL pรบblica de la app" "false"
add_env_var "NEXT_PUBLIC_ENVIRONMENT" "Nombre del entorno (production)" "false"

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# RESUMEN
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

echo ""
echo -e "${GREEN}โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ${NC}"
echo -e "${GREEN}โ CONFIGURACIรN COMPLETADA${NC}"
echo -e "${GREEN}โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ${NC}"
echo ""
echo -e "${CYAN}Variables configuradas actualmente:${NC}"
vercel env ls
echo ""
echo -e "${YELLOW}Para desplegar a producciรณn:${NC}"
echo "   vercel --prod"
echo ""
